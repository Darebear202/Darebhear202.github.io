<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>主人 vs 小狗飞行棋</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: "Microsoft YaHei", sans-serif;
      background: linear-gradient(to bottom, #fff0f5, #ffe4e1);
      min-height: 100vh;
      text-align: center;
      color: #333;
      font-size: 16px;
    }
    h1 { color: #ff1493; margin: 10px 0; font-size: 1.6rem; }
    .safety { font-size: 0.85rem; color: #555; margin: 8px 0 14px; line-height: 1.4; }
    #dice {
      font-size: 4.8rem;
      margin: 15px auto;
      color: #ff4500;
      width: 110px;
      height: 110px;
      line-height: 110px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 5px 18px rgba(0,0,0,0.2);
    }
    #board {
      background: white;
      border-radius: 14px;
      padding: 8px;
      margin: 0 auto;
      max-width: 98vw;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
    }
    .cell {
      aspect-ratio: 1;
      background: #f0f8ff;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      border: 1px solid #b3d9ff;
      position: relative;
    }
    .cell.even { background: #fff0f5; border-color: #ffc1cc; }
    .current { background: #ff69b4 !important; color: white; transform: scale(1.05); }
    .player {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      font-size: 0.85rem;
      line-height: 34px;
      color: white;
      font-weight: bold;
      position: absolute;
      bottom: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .girl { background: #ff69b4; }
    .boy { background: #1e90ff; }
    #task {
      background: white;
      border-radius: 14px;
      padding: 14px;
      margin: 16px auto;
      max-width: 98vw;
      min-height: 100px;
      font-size: 0.95rem;
      line-height: 1.5;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    button {
      padding: 12px 28px;
      font-size: 1.05rem;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      color: white;
      margin: 8px 6px;
      cursor: pointer;
    }
    #rollBtn { background: #ff4757; }
    #doneBtn { background: #2ed573; display: none; }
    #resetBtn { background: #7f8c8d; }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 16px;
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 8px;
      right: 16px;
      font-size: 2.4rem;
      cursor: pointer;
      color: #777;
    }
  </style>
</head>
<body>

<h1>主人 vs 小狗飞行棋</h1>
<p class="safety">安全词：黄（轻点/慢点）　红（立刻停）<br>空格或点击掷骰子，笑场就抱抱继续～</p>

<div id="dice">🎲</div>

<div id="board">
  <div id="grid" class="grid"></div>
</div>

<div id="task">
  点击“掷骰子”或按空格开始！<br>当前轮到：小狗
</div>

<div>
  <button id="rollBtn">掷骰子 🎲 (轮到小狗)</button>
  <button id="doneBtn">任务完成 ✓</button>
  <button id="resetBtn">重置游戏（随机新任务）</button>
</div>

<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close-btn" onclick="closeModal()">×</span>
    <div id="modalText"></div>
  </div>
</div>

<script>
// 任务分类（总共约250条，分为20个大类，每类8-15条不等）
const categories = {
  kneelKiss: [
    "小狗跪下亲主人脚背10秒",
    "小狗跪舔主人手指10秒",
    "小狗跪舔主人棒棒30秒",
    "小狗跪着给主人深喉口交20秒",
    "小狗跪着用嘴侍奉主人30秒",
    "小狗跪舔主人到射",
    "小狗跪着深喉主人棒棒20秒"
  ],
  poseHold: [
    "小狗双手举高保持15秒",
    "小狗M字腿坐姿保持20秒",
    "小狗趴下给主人当脚凳15秒",
    "小狗翘高屁股，主人揉臀30秒",
    "小狗双手抱头，主人摸胸或腰20秒",
    "小狗跪姿保持30秒",
    "小狗狗爬式保持20秒",
    "小狗翘屁股保持姿势15秒"
  ],
  slapBeat: [
    "小狗翘屁股，主人轻拍5下",
    "主人拍小狗屁股10下，小狗自己数",
    "主人执行：扇小狗脸3下",
    "主人执行：扇小狗奶子5下",
    "主人执行：抽打小狗大腿内侧5下",
    "小狗翘屁股，主人抽打屁股15下",
    "主人执行：扇小狗屁股",
    "主人执行：抽打小狗大腿",
    "主人执行：扇巴掌"
  ],
  blindfoldFeather: [
    "小狗戴眼罩，主人用羽毛刮身体30秒",
    "小狗戴眼罩，主人用手指轻触全身20秒",
    "小狗戴眼罩，主人用冰块滑过奶头"
  ],
  nipplePlay: [
    "主人捏小狗奶头5次",
    "小狗夹两个奶夹保持45秒",
    "小狗自摸奶头10秒",
    "主人执行：扇小狗奶子5下",
    "主人执行：抽打小狗奶子",
    "小狗奶头被主人用跳蛋震动20秒",
    "小狗奶头被主人用冰块刺激30秒"
  ],
  collarLeash: [
    "小狗戴项圈跪姿30秒",
    "主人牵着小狗项圈链子，让小狗爬10步",
    "主人牵着小狗链子，让小狗跪着爬半圈",
    "主人执行：戴项圈跪姿20秒",
    "主人牵链子让小狗狗爬式移动"
  ],
  gagMuzzle: [
    "小狗戴口球哼哼30秒",
    "小狗戴口球+鼻勾，哼哼爬行20秒",
    "小狗戴口球+眼罩，主人随意摸30秒",
    "小狗戴口球，主人命令哼叫"
  ],
  bellClamp: [
    "小狗戴铃铛奶夹，走一圈不准响太大",
    "小狗夹铃铛奶夹，走一圈摇晃",
    "小狗戴铃铛项圈，走动时铃响"
  ],
  tailPlug: [
    "小狗戴小尾巴肛塞，狗爬式摇尾巴20秒"
  ],
  eggVibrate: [
    "小狗塞小跳蛋（低档），跪姿30秒",
    "小狗塞振动跳蛋（低档），跪等主人",
    "小狗翘屁股，主人用跳蛋在外侧震动15秒",
    "小狗带着跳蛋出门，主人随时遥控",
    "小狗带着跳蛋出门，主人低档遥控",
    "小狗带着跳蛋出门，主人中档遥控",
    "小狗带着跳蛋出门，主人高档遥控",
    "小狗带着跳蛋出门，主人间歇调档"
  ],
  ropeBind: [
    "小狗被绳子简单捆绑双手，跪姿30秒",
    "小狗被主人用绳子绑成M字腿，保持20秒",
    "小狗被绳子捆胸，保持跪姿30秒",
    "主人执行：用绳子绑小狗双手吊起，站姿10秒",
    "小狗被绳子绑成龟甲缚，跪姿20秒",
    "小狗被绳子绑腿，M字开腿保持"
  ],
  oralSex: [
    "小狗跪着给主人深喉口交20秒",
    "小狗跪舔主人棒棒30秒",
    "小狗用嘴侍奉主人到边缘",
    "小狗跪着深喉主人棒棒20秒",
    "小狗用嘴含主人棒棒摇动",
    "小狗给主人完整口交30秒",
    "小狗用嘴侍奉主人到高潮"
  ],
  swallowCum: [
    "小狗跪着给主人完整口交后吞下",
    "主人执行：射在小狗嘴里，小狗吞精",
    "小狗跪舔主人到射，全部吞下",
    "主人执行：射在小狗舌头上，小狗吞精",
    "小狗深喉口交到射，吞下精液",
    "主人执行：射在小狗嘴里，小狗吞精后说谢谢",
    "小狗用嘴侍奉主人到射，吞精"
  ],
  intercourse: [
    "主人抱着小狗，站立式插入操30秒",
    "小狗骑在主人身上，女上位坐上去摇动20秒",
    "主人从后面抱着小狗，后入式操10下",
    "小狗跪着，主人从前抱着操小狗的骚逼",
    "小狗骑乘位坐在主人身上，主动摇臀20秒",
    "主人抱着小狗腿，传教士位深插30秒",
    "小狗趴着，主人从后抱着腰猛操",
    "小狗被主人抱起，双腿缠腰操10秒",
    "主人从后面抱着小狗，站立后入操",
    "小狗坐在主人腿上，面对面骑乘摇动",
    "小狗翘屁股，主人抱着腰从后猛插",
    "小狗被主人抱起，边走边操",
    "主人抱着小狗，靠墙站立式深插",
    "小狗骑乘位，主人托着屁股向上顶",
    "小狗趴在主人身上，主人从下向上操"
  ],
  analPlay: [
    "主人给小狗后面涂满润滑，慢慢浅入10秒",
    "小狗翘屁股，主人从后浅插肛门20秒",
    "主人从后面抱着小狗，浅插肛门",
    "小狗跪着，主人从后浅插肛门",
    "小狗翘屁股，主人慢慢深一点插后面",
    "主人执行：用手指浅插小狗后面，让小狗适应",
    "主人用小号肛塞先扩张，再浅插",
    "主人从后抱着小狗腰，缓慢肛交15秒",
    "主人执行：抱着小狗腿，从后浅插肛门",
    "主人执行：让小狗骑在身上，从下向上浅插后面",
    "主人给小狗后面涂润滑，用手指+跳蛋双重准备",
    "主人从后抱着小狗，肛交到边缘",
    "主人执行：用小号肛塞+润滑，让小狗自己坐下去"
  ],
  photoMark: [
    "主人拍照小狗翘屁股的样子，只给他看",
    "小狗自己拍奶子照发给主人",
    "主人拍照小狗高潮脸，只给他看",
    "主人拍照小狗戴口球的样子，只给他看",
    "主人拍照小狗M字腿的样子，只给他看",
    "主人拍照小狗跪舔的样子，只给他看",
    "主人拍照小狗高潮喷水的样子，只给他看"
  ],
  smearLick: [
    "主人执行：涂蜂蜜在小狗奶头上，小狗舔掉",
    "小狗涂巧克力酱在主人棒棒上，舔干净",
    "主人执行：涂牛奶在小狗奶头上，小狗舔掉",
    "小狗给主人涂蜂蜜在胸口，舔干净",
    "主人执行：涂润滑油在小狗奶子上，按摩拍照",
    "主人执行：涂蜂蜜在小狗奶头，让小狗舔掉",
    "小狗涂巧克力在主人手指，舔干净",
    "主人执行：涂牛奶在小狗奶头上，让小狗舔掉",
    "小狗涂蜂蜜在主人棒棒，跪舔干净"
  ],
  temperature: [
    "主人执行：用蜡烛滴小狗奶头3滴（低温）",
    "主人执行：用冰块滑小狗奶头和骚逼30秒",
    "主人执行：用冰块+热手交替玩小狗奶头",
    "主人执行：用低温蜡滴小狗大腿内侧3滴"
  ],
  humiliation: [
    "小狗重复5次：我是爸爸的专属肉便器",
    "小狗说：爸爸，小狗的骚逼和奶子都是你的玩具，随便玩",
    "小狗跪着说：爸爸，小狗是你的贱狗，求爸爸羞辱我",
    "小狗写20遍：小狗是爸爸的欠操贱母狗",
    "小狗对着镜子说：我是爸爸的骚货，平时装乖其实最浪",
    "主人执行：命令小狗说『小狗的骚逼只为爸爸张开』",
    "小狗说：爸爸，小狗下面好痒，好想被你操烂",
    "小狗重复3次：爸爸，小狗是你的精液桶",
    "主人执行：让小狗跪着说『谢谢爸爸赏赐精液』",
    "小狗说：爸爸，小狗的奶头和骚逼都欠抽欠操",
    "小狗跪求：爸爸，骂小狗是贱逼母狗吧",
    "主人执行：言语羞辱：『看你这骚样，欠操的母狗』",
    "小狗说：爸爸，小狗愿意被你当狗一样牵着操",
    "小狗重复：爸爸，我是你的专属肉便器母狗",
    "小狗说：爸爸，小狗的下面和奶子都属于你，随便虐",
    "主人执行：命令小狗说『小狗的骚逼永远是爸爸的洞』",
    "小狗说：爸爸，小狗好贱，好想被你羞辱到高潮",
    "小狗写30遍：我是爸爸的贱狗骚逼",
    "主人执行：让小狗跪着说『爸爸，小狗的嘴和下面都是你的套子』",
    "小狗说：爸爸，小狗平时装乖，其实最欠爸爸收拾"
  ]
};

// 固定起点和终点
const startTask = "起点：什么都没有，继续玩～";
const endTask = "终点：赢家要求彻底释放（主人允许高潮，或小狗完整侍奉主人）";

// 当前任务数组
let currentTasks = [];

// 判断是否为台词类任务
function isDialogueTask(task) {
  const lower = task.toLowerCase();
  return lower.includes('说') || lower.includes('重复') || lower.includes('叫') || lower.includes('言语') || lower.includes('羞辱') || lower.includes('谢谢') || lower.includes('求');
}

// 随机抽取：从每个类别均匀抽取（每类尽量抽2~4条），同一具体任务不重复，台词≤10个
function shuffleAndSelectTasks() {
  let attempts = 0;
  const maxAttempts = 100;

  while (attempts < maxAttempts) {
    attempts++;
    let selected = [];
    let used = new Set();

    const categoryKeys = Object.keys(categories);
    const numCategories = categoryKeys.length;
    const targetPerCat = Math.floor(50 / numCategories); // 每类目标数量
    let remaining = 50;

    // 优先从每个类别抽取
    categoryKeys.forEach(cat => {
      let items = categories[cat].slice();
      for (let i = items.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [items[i], items[j]] = [items[j], items[i]];
      }
      let take = Math.min(targetPerCat + (remaining > targetPerCat * numCategories ? 1 : 0), items.length);
      for (let i = 0; i < take && remaining > 0; i++) {
        let task = items[i];
        if (!used.has(task)) {
          selected.push(task);
          used.add(task);
          remaining--;
        }
      }
    });

    // 如果还不够50条，从剩余随机补
    if (remaining > 0) {
      let allRemaining = [];
      Object.values(categories).flat().forEach(t => {
        if (!used.has(t)) allRemaining.push(t);
      });
      for (let i = allRemaining.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allRemaining[i], allRemaining[j]] = [allRemaining[j], allRemaining[i]];
      }
      selected.push(...allRemaining.slice(0, remaining));
    }

    // 检查台词数量
    const dialogueCount = selected.filter(isDialogueTask).length;
    if (dialogueCount <= 10) {
      currentTasks = [startTask, ...selected, endTask];
      return;
    }
  }

  // 兜底（极少发生）
  currentTasks = [startTask, ...Object.values(categories).flat().slice(0, 50), endTask];
}

// 初始抽取
shuffleAndSelectTasks();

let dogPos = 0;
let masterPos = 0;
let turn = "小狗";
let currentPos = 0;

const grid = document.getElementById('grid');
const dice = document.getElementById('dice');
const taskEl = document.getElementById('task');
const rollBtn = document.getElementById('rollBtn');
const doneBtn = document.getElementById('doneBtn');
const modal = document.getElementById('modal');
const modalText = document.getElementById('modalText');

const specialEffects = ['前进2格', '前进3格', '前进4格', '后退2格', '后退3格', '后退4格'];
const specialCells = new Map();

function initSpecialCells() {
  specialCells.clear();
  const positions = new Set();
  while (positions.size < 5) {
    const pos = Math.floor(Math.random() * 44) + 8;
    positions.add(pos);
  }
  positions.forEach(pos => {
    const effect = specialEffects[Math.floor(Math.random() * specialEffects.length)];
    specialCells.set(pos, effect);
  });
}

function drawBoard() {
  grid.innerHTML = '';
  let index = 0;
  let direction = 1;
  for (let row = 0; row < 9; row++) {
    let start = direction === 1 ? 0 : 5;
    let end = direction === 1 ? 6 : -1;
    let step = direction === 1 ? 1 : -1;
    for (let col = start; col !== end; col += step) {
      if (index >= 52) break;
      const cell = document.createElement('div');
      cell.className = 'cell' + (index % 2 === 0 ? '' : ' even');
      cell.innerHTML = `<div>${index === 0 ? '起点' : index === 51 ? '终点' : index}</div>`;
      if (specialCells.has(index)) {
        cell.innerHTML += `<div style="font-size:0.6rem;color:#e74c3c;">特殊: ${specialCells.get(index)}</div>`;
      }
      cell.onclick = () => showInstruction(index);
      grid.appendChild(cell);
      index++;
    }
    direction *= -1;
  }
}

function updatePieces() {
  document.querySelectorAll('.player').forEach(p => p.remove());
  const cells = document.querySelectorAll('.cell');
  if (cells[dogPos]) {
    const dog = document.createElement('div');
    dog.className = 'player girl';
    dog.textContent = '小狗';
    cells[dogPos].appendChild(dog);
  }
  if (cells[masterPos]) {
    const master = document.createElement('div');
    master.className = 'player boy';
    master.textContent = '主人';
    cells[masterPos].appendChild(master);
  }
}

function showInstruction(pos) {
  if (pos < 0 || pos >= currentTasks.length) return;
  let html = `<strong>格子 ${pos + 1}：</strong><br>${currentTasks[pos]}`;
  if (specialCells.has(pos)) {
    html += `<br><br><strong style="color:#e74c3c;">特殊效果：${specialCells.get(pos)}</strong>`;
  }
  modalText.innerHTML = html;
  modal.style.display = 'flex';
}

function closeModal() {
  modal.style.display = 'none';
}

function rollDice() {
  rollBtn.disabled = true;
  doneBtn.style.display = 'none';
  let count = 0;
  const iv = setInterval(() => {
    dice.textContent = Math.floor(Math.random() * 6) + 1;
    count++;
    if (count > 12) {
      clearInterval(iv);
      const num = Math.floor(Math.random() * 6) + 1;
      dice.textContent = num;
      movePiece(num);
    }
  }, 90);
}

function applySpecial(pos) {
  if (!specialCells.has(pos)) return 0;
  const effect = specialCells.get(pos);
  const m = effect.match(/(前进|后退)(\d+)格/);
  if (!m) return 0;
  return (m[1] === '前进' ? 1 : -1) * Number(m[2]);
}

function movePiece(steps, isAuto = false) {
  let pos = turn === "小狗" ? dogPos : masterPos;
  let moved = 0;

  const interval = setInterval(() => {
    if (moved >= steps || pos >= 51 || (pos <= 0 && moved > 0)) {
      clearInterval(interval);

      let finalPos = Math.max(0, Math.min(51, pos));
      if (pos < 0) {
        taskEl.innerHTML += `<br><span style="color:#e74c3c;">后退超出起点，已停在起点～</span>`;
      }

      if (turn === "小狗") dogPos = finalPos;
      else masterPos = finalPos;

      updatePieces();
      currentPos = finalPos;

      let text = `<strong>落格 ${finalPos + 1}：</strong><br>${currentTasks[finalPos]}`;
      const extra = applySpecial(finalPos);

      if (extra !== 0 && !isAuto) {
        const dir = extra > 0 ? '前进' : '后退';
        taskEl.innerHTML = text + `<br><br>触发特殊！${dir}${Math.abs(extra)}格...`;
        setTimeout(() => movePiece(Math.abs(extra), true), 1200);
        return;
      }

      showInstruction(finalPos);
      taskEl.innerHTML = text + (isAuto ? '' : '<br><br>请完成任务～');

      if (!isAuto) {
        doneBtn.style.display = 'inline-block';
      } else {
        finishTurn();
      }
      return;
    }

    pos++;
    moved++;
    if (turn === "小狗") dogPos = pos;
    else masterPos = pos;
    updatePieces();

    document.querySelectorAll('.cell').forEach(c => c.classList.remove('current'));
    const cells = document.querySelectorAll('.cell');
    if (cells[pos]) cells[pos].classList.add('current');
  }, 380);
}

function finishTurn() {
  document.querySelectorAll('.cell').forEach(c => c.classList.remove('current'));
  turn = turn === "小狗" ? "主人" : "小狗";
  rollBtn.textContent = `掷骰子 🎲 (轮到${turn})`;
  taskEl.innerHTML = `当前轮到：${turn}<br>准备掷骰子～`;
  doneBtn.style.display = 'none';
  rollBtn.disabled = false;

  if (currentPos >= 51) {
    setTimeout(() => {
      alert(`${turn === "小狗" ? "主人" : "小狗"}先到终点！\n${currentTasks[51]}\n游戏结束～`);
      rollBtn.disabled = true;
    }, 800);
  }
}

rollBtn.onclick = rollDice;
doneBtn.onclick = finishTurn;

document.getElementById('resetBtn').onclick = () => {
  dogPos = masterPos = currentPos = 0;
  turn = "小狗";
  shuffleAndSelectTasks();
  initSpecialCells();
  drawBoard();
  updatePieces();
  rollBtn.textContent = "掷骰子 🎲 (轮到小狗)";
  rollBtn.disabled = false;
  doneBtn.style.display = 'none';
  taskEl.innerHTML = "起点：什么都没有，继续玩～<br>当前轮到：小狗";
};

document.addEventListener('keydown', e => {
  if ((e.code === 'Space' || e.code === 'Enter') && !rollBtn.disabled) {
    e.preventDefault();
    rollDice();
  }
});

grid.addEventListener('click', e => {
  const cell = e.target.closest('.cell');
  if (!cell) return;
  const idx = Array.from(grid.children).indexOf(cell);
  if (idx >= 0) showInstruction(idx);
});

initSpecialCells();
drawBoard();
updatePieces();
</script>
</body>
</html>
